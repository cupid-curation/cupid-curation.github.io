<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="CUPID: Curating Data your Robot Loves with Influence Functions">
  <meta name="keywords" content=" Imitation Learning, Data Curation, Influence Functions">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CUPID: Curating Data your Robot Loves with Influence Functions</title>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script>

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <!-- <link rel="icon" href="./static/images/favicon.svg"> -->
  <link rel="icon" href="./static/images/arrow-favicon.png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  
</head>

<body>



<!-- Navigation bar -->
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <!-- <a class="navbar-item" href="https://www.chrisagia.com/">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a> -->

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          Related Research
        </a>
        <div class="navbar-dropdown">
          <a class="navbar-item" href="https://sites.google.com/stanford.edu/sentinel">
            Sentinel
          </a>
          <a class="navbar-item" href="https://sites.google.com/view/aesop-llm">
            AESOP
          </a>
          <a class="navbar-item" href="https://trak.csail.mit.edu/">
            TRAK
          </a>
          <a class="navbar-item" href="https://arxiv.org/abs/1703.04730">
            Influence Functions
          </a>
        </div>
      </div>
    </div>

  </div>
</nav>



<section class="hero hero-section-with-bg">
  <div class="hero-bg"></div>
  <div class="hero-body">

    <!-- Paper links -->
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title">CUPID: Curating Data your Robot Loves ðŸ’˜<br>with Influence Functions</h1>
          <div class="is-size-5 publication-authors">
            <span class="author-block">
              <a href="https://www.chrisagia.com/">Christopher Agia</a><sup>1</sup>,</span>
            <span class="author-block">
              <a href="https://stanfordasl.github.io//people/rohan-sinha/">Rohan Sinha</a><sup>1</sup>,</span>
            <span class="author-block">
              <a href="http://yjy0625.github.io/">Jingyun Yang</a><sup>1</sup>,
            </span>
            <br>
            <span class="author-block">
              <a href="https://contactrika.github.io/">Rika Antonova</a><sup>2</sup>,
            </span>
            <span class="author-block">
              <a href="https://stanfordasl.github.io//people/prof-marco-pavone/">Marco Pavone</a><sup>1,3</sup>,
            </span>
            <span class="author-block">
              <a href="https://harukins.github.io/">Haruki Nishimura</a><sup>4</sup>,
            </span>
            <span class="author-block">
              <a href="https://mashaitkina.weebly.com/">Masha Itkina</a><sup>4</sup>,
            </span>
            <span class="author-block">
              <a href="https://web.stanford.edu/~bohg/">Jeannette Bohg</a><sup>1</sup>
            </span>
          </div>

          <div class="is-size-5 publication-authors">
            <span class="author-block"><sup>1</sup>Stanford University,</span>
            <span class="author-block"><sup>2</sup>University of Cambridge,</span>
            <span class="author-block"><sup>3</sup>NVIDIA Research,</span>
            <span class="author-block"><sup>4</sup>Toyota Research Institute</span>
          </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- PDF Link. -->
              <span class="link-block">
                <a href="./static/pdfs/CUPID-Curation-2025.pdf"
                  class="external-link button is-normal is-rounded is-dark"
                  target="_blank" rel="noopener">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <!-- <span class="link-block">
                <a href="https://arxiv.org/abs/"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>Coming soon!</span>
                </a>
              </span> -->
              <!-- Video Link. -->
              <span class="link-block">
                <a href="https://youtu.be/0kmIiEjTqV8"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Video</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://cupid-curation.github.io/"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Coming soon!</span>
                  </a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CUPID GIF. -->
    <div class="container is-max-desktop">
      <div class="hero-body">
        <img src="./static/gifs/walkthrough.gif" alt="CUPID Walkthrough GIF"
            style="max-width:100%; height:auto; display:block; margin:0 auto 0rem auto; border-radius:10px;">
      </div>
    </div>

  </div>
</section>



<!-- TLDR. -->
<section class="tldr-section">
  <div class="container is-max-widescreen">
    <div class="tldr-box">
      <h2 class="tldr-title">TL;DR</h2>
      <p class="tldr-text">
        <strong>CUPID</strong> (<strong>CU</strong>rating <strong>P</strong>erformance-<strong>I</strong>nfluencing <strong>D</strong>emonstrations)
        is a data curation method for robot imitation learning that uses <span style="color:#E3862C;">influence functions</span> to estimate the causal impact of each demonstration on a policyâ€™s closed-loop performance.
        I.e., CUPID provides a principled way to 
          (i) ðŸ§¹ <span style="color:#76B34A;">filter existing training sets</span> and 
          (ii) ðŸŽ¯ <span style="color:#76B34A;">subselect helpful demos</span> from new data.
      </p>
    </div>
  </div>
</section>



<!-- Video & Abstract. -->
<section class="section hero-section-with-bg">
  <div class="hero-bg"></div>

  <!-- Video. -->
  <div class="container is-max-desktop video-block">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Video</h2>
        <div class="publication-video">
          <iframe src="https://www.youtube.com/embed/0kmIiEjTqV8"
                  frameborder="0"
                  allow="autoplay; encrypted-media"
                  allowfullscreen></iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- Abstract. -->
  <div class="container is-max-desktop abstract-block">
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            In robot imitation learning, policy performance is tightly coupled with the quality and composition of the demonstration data. 
            Yet, developing a precise understanding of how individual demonstrations contribute to downstream outcomes - such as closed-loop task success or failure - remains a persistent challenge. 
            We propose CUPID, a robot data curation method based on a novel influence function-theoretic formulation for imitation learning policies. 
            Given a set of evaluation rollouts, CUPID estimates the influence of each training demonstration on the policyâ€™s expected return. 
            This enables ranking and selection of demonstrations according to their impact on the policyâ€™s closed-loop performance. 
            We use CUPID to curate data by 1) filtering out training demonstrations that harm policy performance and 2) subselecting newly collected trajectories that will most improve the policy. 
            Extensive simulated and hardware experiments show that our approach consistently identifies which data drives test-time performance. 
            For example, training with less than 33% of curated data can yield state-of-the-art diffusion policies on the simulated RoboMimic benchmark, with similar gains observed in hardware. 
            Furthermore, hardware experiments show that our method can identify robust strategies under distribution shift, isolate spurious correlations, and even enhance the post-training of generalist robot policies.
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Approach. -->
  <div class="container is-max-desktop approach-block">
      <h2 class="title is-3">Approach</h2>
      <img src="./static/images/method.png" alt="CUPID Method Overview" style="max-width:100%; height:auto; display:block; margin:0 auto;">
      <h2 class="subtitle has-text-centered">
        <strong>Curation Overview.</strong> Upon estimating a BC policy's expected return from a set of rollouts, CUPID ranks demos based on their measured influence 
        on this performance estimate and selects the top-k. Thus, curating with CUPID results in a dataset of demos that most strongly influences closed-loop success.
      </h2>
  </div>

</section>



<!-- Teaser figure -->
<!-- <section class="hero teaser hero-section-with-bg">
  <div class="hero-bg"></div>
  <div class="container is-max-desktop">
    <div class="hero-body">
      <img src="./static/images/teaser.png" alt="CUPID Method Teaser" style="max-width:100%; height:auto; display:block; margin:0 auto;">
      <h2 class="subtitle has-text-centered">
        We propose a data curation method for robot imitation learning that uses influence functions to measure the causal impact of a demonstration on the policy's closed-loop performance.
      </h2>
    </div>
  </div>
</section> -->



<!-- Main Robot Results. -->
<section class="section experiments-block">
  <!-- <div class="container is-max-desktop"> -->
  <div class="container is-max-widescreen">

    <h2 class="title is-3">Robot Experiments</h2>
    
    <!-- Diffusion Policy Performance. -->
    <div style="margin-top: 2rem;"></div>
    <div class="content">
      <h3 class="title is-5">Improving Diffusion Policies by Debugging Training Data</h3>
      <img src="./static/images/franka_image_dp_performance.jpg" alt="Franka Diffusion Policy Performance" style="max-width:100%; height:auto; display:block; margin:0;">
      <img src="./static/images/hardware_tasks_annotated.jpg" alt="Franka Hardware Tasks" style="max-width:100%; height:auto; display:block; margin-top:4px; margin-bottom:8px;">
      <p>
        <strong>Franka real-world diffusion policy performance.</strong> 
        CUPID, which curates demonstrations <em>w.r.t.</em> policy performance, improves success rates on mixed-quality datasets, identifies robust strategies, and disentangles 
        spurious correlations that hinder performance. Although quality measures (e.g., <a href="https://joeyhejna.com/demonstration-info/">DemInf</a>, CUPID-Quality) help in mixed-quality settings (Figure-8), they degrade performance 
        when higher-quality demonstrations induce brittle strategies at test time (TuckBox), or when quality is not the primary factor limiting policy success (Bookshelf). 
        Overall, curating data based on performance (CUPID) maintains robustness across these settings. 
        All data curation methods are limited to using 25 policy rollouts. Success rates are averaged over 25 rollouts.
      </p>
    </div>

    <!-- PI-0 Transfer Performance. -->
    <div style="margin-top: 3rem;"></div>
    <h3 class="title is-5">Curated Post-Training for Vision-Language-Action (VLA) Models</h3>
    <!-- <div class="columns is-centered"> -->
      <!-- Transfer Results. -->
      <!-- <div class="column">        
        <div class="content">
          <h3 class="title is-6">Transferring Datasets from Single-task Policies</h3>
          <img src="./static/images/franka_image_pi0_performance.jpg" alt="Franka PI-0 Transfer Performance" style="max-width:70%; height:auto; display:block; margin:4px auto 8px auto;">
          <p>
            <strong>Add content.</strong>
          </p>
        </div>
      </div> -->

      <!-- LoRA Results. -->
      <!-- <div class="column">        
        <div class="content">
          <h3 class="title is-6">Curating Datasets for LoRA Fine-Tuned Weights</h3>
          <img src="./static/images/franka_image_pi0_performance.jpg" alt="Franka PI-0 Transfer Performance" style="max-width:70%; height:auto; display:block; margin:4px auto 8px auto;">
          <p>
            <strong>Add content.</strong>
          </p>
        </div>
      </div> -->
    <!-- </div> -->

    <div class="content" style="margin-top: 2rem;">

      <h3 class="title is-6">Transferring Curated Datasets from Single-task Policies to Multi-task VLAs</h3>
      <!-- Side-by-side images container -->
      <div style="display: flex; gap: 3rem; justify-content: center; align-items: flex-start;">
        
        <!-- First image: 1/3 width -->
        <img src="./static/images/franka_image_pi0_performance.jpg"
            alt="Franka Performance"
            style="width: 30%; height: auto; display: block;">

        <!-- Second image: 2/3 width -->
        <img src="./static/images/transfer.jpg"
            alt="Transfer Performance"
            style="width: 66%; height: auto; display: block;">

      </div>

      <!-- Shared caption -->
      <p class="has-text-centered" style="margin-top: 0.75rem;">
        <strong>Franka real-world \( \mathbf{\pi_0} \) VLA performance.</strong> 
        Data curated for single-task diffusion policies improves \( \mathbf{\pi_0} \) <a href="https://www.physicalintelligence.company/blog/pi0">[1]</a> post-training performance.
        This highlights a promising direction to alleviate the computational cost of CUPID in large-scale settings: 
        use smaller, single-task policies to curate datasets for larger, multi-task VLAs.
        The results also suggest that scaling the pre-training of VLAs does not inherently enable them to leverage 
        their generalist knowledge to, e.g., <em>ignore</em> low-quality behaviors or brittle strategies in demonstration data. 
        That is, data curation still appears important for VLA post-training. 
      </p>
    </div>

  </div>
</section>



<hr>



<!-- Standard double column template -->
<section class="section experiments-block">
  <!-- <div class="container is-max-desktop"> -->
  <div class="container is-max-widescreen">
    
    <!-- Diffusion Policy Rollouts. -->
    <h2 class="title is-3">Diffusion Policy Rollouts</h2>

    <!-- Diffusion Policy Figure-8 -->
    <div style="margin-top: 2rem;"></div>
    <h3 class="title is-5">Figure-8: Improving Policy Performance in Mixed-Quality Regimes</h3>
    <div class="columns is-centered is-variable is-2">
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_figure8-video1" class="video-cropped figure8" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_figure8/base1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_figure8-caption1" class="is-size-6 mt-2">Base Policy - All Demos</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_figure8-video2" class="video-cropped figure8" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_figure8/demoscore1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_figure8-caption2" class="is-size-6 mt-2">Demo-SCORE [2]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_figure8-video3" class="video-cropped figure8" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_figure8/deminf1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_figure8-caption3" class="is-size-6 mt-2">DemInf [3]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_figure8-video4" class="video-cropped figure8" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_figure8/cupid1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_figure8-caption4" class="is-size-6 mt-2">CUPID (Ours)</p>
        </div>
      </div>
    </div>
    <div class="buttons has-addons is-centered mb-4">
      <button class="toggle-button is-selected" onclick="switchSet('dp_figure8', 0)">Sample #1</button>
      <button class="toggle-button" onclick="switchSet('dp_figure8', 1)">Sample #2</button>
      <button class="toggle-button" onclick="switchSet('dp_figure8', 2)">Sample #3</button>
    </div>

    <!-- Diffusion Policy TuckBox -->
    <div style="margin-top: 3rem;"></div>
    <h3 class="title is-5">TuckBox: Identifying Robust Test-Time Strategies from Policy Failures</h3>
    <div class="columns is-centered is-variable is-2">
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_tuckbox-video1" class="video-cropped tuckbox" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_tuckbox/base1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_tuckbox-caption1" class="is-size-6 mt-2">Base Policy - All Demos</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <!-- Hidden video (so JS works) -->
            <video id="dp_tuckbox-video2" class="video-cropped tuckbox" autoplay muted loop playsinline controls style="display: none;">
              <source src="" type="video/mp4">
            </video>
            <!-- Placeholder div (same aspect and styling) -->
            <div id="dp_tuckbox-placeholder2" class="video-cropped tuckbox placeholder-gray" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0;"></div>
          </div>
          <p id="dp_tuckbox-caption2" class="is-size-6 mt-2">Demo-SCORE [2]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_tuckbox-video3" class="video-cropped tuckbox" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_tuckbox/deminf1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_tuckbox-caption3" class="is-size-6 mt-2">DemInf [3]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_tuckbox-video4" class="video-cropped tuckbox" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_tuckbox/cupid1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_tuckbox-caption4" class="is-size-6 mt-2">CUPID (Ours)</p>
        </div>
      </div>
    </div>
    <div class="buttons has-addons is-centered mb-4">
      <button class="toggle-button is-selected" onclick="switchSet('dp_tuckbox', 0)">Sample #1</button>
      <button class="toggle-button" onclick="switchSet('dp_tuckbox', 1)">Sample #2</button>
      <button class="toggle-button" onclick="switchSet('dp_tuckbox', 2)">Sample #3</button>
    </div>

    <!-- Diffusion Policy Bookshelf -->
    <div style="margin-top: 3rem;"></div>
    <h3 class="title is-5">Bookshelf: Disentangling Spurious Correlations in Demonstration Data</h3>
    <div class="columns is-centered is-variable is-2">
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_bookshelf-video1" class="video-cropped bookshelf" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_bookshelf/base1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_bookshelf-caption1" class="is-size-6 mt-2">Base Policy - All Demos</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_bookshelf-video2" class="video-cropped bookshelf" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_bookshelf/demoscore1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_bookshelf-caption2" class="is-size-6 mt-2">Demo-SCORE [2]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_bookshelf-video3" class="video-cropped bookshelf" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_bookshelf/deminf1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_bookshelf-caption3" class="is-size-6 mt-2">DemInf [3]</p>
        </div>
      </div>
      <div class="column is-one-quarter">
        <div class="content has-text-centered">
          <div class="video-crop-container">
            <video id="dp_bookshelf-video4" class="video-cropped bookshelf" autoplay muted loop playsinline controls>
              <source src="./static/videos/dp_bookshelf/cupid1.mp4" type="video/mp4">
            </video>
          </div>
          <p id="dp_bookshelf-caption4" class="is-size-6 mt-2">CUPID (Ours)</p>
        </div>
      </div>
    </div>
    <div class="buttons has-addons is-centered mb-4">
      <button class="toggle-button is-selected" onclick="switchSet('dp_bookshelf', 0)">Sample #1</button>
      <button class="toggle-button" onclick="switchSet('dp_bookshelf', 1)">Sample #2</button>
      <button class="toggle-button" onclick="switchSet('dp_bookshelf', 2)">Sample #3</button>
    </div>

    <!-- PI-0 Rollouts -->
    <div style="margin-top: 6rem;"></div>
    <h2 class="title is-3">\( \mathbf{\pi_0} \) VLA Rollouts</h2>

    <!-- Shared row for both tasks -->
    <div style="margin-top: 1rem;"></div>
    <div class="task-row">
      <!-- Figure-8 Task -->
      <div class="task-section">
        <h3 class="title is-5 task-title">Figure-8: VLA Performance in Mixed-Quality Regimes</h3>
        <div class="video-pair">
          <div class="video-column content has-text-centered">
            <div class="video-crop-container">
              <video id="pi0_figure8-video1" class="video-cropped figure8" autoplay muted loop playsinline controls>
                <source src="./static/videos/pi0_figure8/base1.mp4" type="video/mp4">
              </video>
            </div>
            <p id="pi0_figure8-caption1" class="is-size-6 mt-2">Fine-Tuned Policy - All Demos</p>
          </div>
          <div class="video-column content has-text-centered">
            <div class="video-crop-container">
              <video id="pi0_figure8-video2" class="video-cropped figure8" autoplay muted loop playsinline controls>
                <source src="./static/videos/pi0_figure8/cupid1.mp4" type="video/mp4">
              </video>
            </div>
            <p id="pi0_figure8-caption2" class="is-size-6 mt-2">CUPID (Ours)</p>
          </div>
        </div>
        <div class="buttons has-addons mb-3">
          <button class="toggle-button is-selected" onclick="switchPi0Set('pi0_figure8', 0)">Sample #1</button>
          <button class="toggle-button" onclick="switchPi0Set('pi0_figure8', 1)">Sample #2</button>
        </div>
      </div>

      <!-- TuckBox Task -->
      <div class="task-section">
        <h3 class="title is-5 task-title">TuckBox: VLA Strategies under Test-time Distribution Shifts</h3>
        <div class="video-pair">
          <div class="video-column content has-text-centered">
            <div class="video-crop-container">
              <video id="pi0_tuckbox-video1" class="video-cropped tuckbox" autoplay muted loop playsinline controls>
                <source src="./static/videos/pi0_tuckbox/base1.mp4" type="video/mp4">
              </video>
            </div>
            <p id="pi0_tuckbox-caption1" class="is-size-6 mt-2">Fine-Tuned Policy - All Demos</p>
          </div>
          <div class="video-column content has-text-centered">
            <div class="video-crop-container">
              <video id="pi0_tuckbox-video2" class="video-cropped tuckbox" autoplay muted loop playsinline controls>
                <source src="./static/videos/pi0_tuckbox/cupid1.mp4" type="video/mp4">
              </video>
            </div>
            <p id="pi0_tuckbox-caption2" class="is-size-6 mt-2">CUPID (Ours)</p>
          </div>
        </div>
        <div class="buttons has-addons mb-3">
          <button class="toggle-button is-selected" onclick="switchPi0Set('pi0_tuckbox', 0)">Sample #1</button>
          <button class="toggle-button" onclick="switchPi0Set('pi0_tuckbox', 1)">Sample #2</button>
        </div>
      </div>
    </div>

  </div>
</section>
<div style="margin-top: -2rem;"></div>



<hr>



<!-- FAQ. -->
<section class="section faq-block">
  <div class="container is-max-widescreen">

    <h2 class="title is-3">Frequently Asked Questions</h2>

    <!-- Q1 -->
    <div class="faq-item">
      <button class="collapsible">Q1: How can we intuitively understand what CUPID is doing?</button>
      <div class="faq-content">
        <p style="margin-bottom: 2rem;">
          <strong>Intuitively, CUPID uses influence functions to predictively answer counterfactual questions</strong> about the effect of each demonstration on downstream policy performance. 
          For example, CUPID enables us to answer questions like <em>"How would my policy's expected return change if I upweighted - or by negating, downweighted - the loss on a demonstration during training?"</em> 
          and it does so without needing to retrain any policies (i.e., predictively). An illustrative example of this is shown in the figure below, where we can see how answering such counterfactual 
          questions can help us understand which demonstrations are helpful or harmful to the policy's performance.
        </p>
        <img src="./static/images/teaser.jpg" alt="CUPID Teaser" style="max-width:100%; height:auto; display:block; margin:0 auto;">
        <p style="text-align: center;">
          <strong>CUPID Overview:</strong> Predictively answering counterfactual questions about policy performance using influence functions.
        </p>
      </div>
    </div>

    <!-- Q2 -->
    <div class="faq-item">
      <button class="collapsible">Q2: What kinds of demonstrations does CUPID curate?</button>
      <div class="faq-content">
        <p style="margin-bottom: 2rem;">         
          <strong>Franka diffusion policy curated dataset distributions for dataset filtering.</strong> CUPID filters out lower-quality demonstrations (Figure-8), brittle strategies (TuckBox), and spuriously correlated examples (Bookshelf), 
          improving policy performance across tasks. While curation heuristics employed by baselines may be effective in some cases (e.g., DemInf and CUPID-Quality in Figure-8), they can lead to suboptimal pruning in others. We observe
          similar patterns in the data selection setting, where CUPID is used to select the most helpful demos from a new dataset (see <a href="./static/pdfs/CUPID-Curation-2025.pdf">paper</a> for details).
        </p>

        <img src="./static/images/franka_image_dp_distribution_filter_dataset_figure8.jpg" alt="Franka Diffusion Policy Figure-8 Distribution" style="max-width:100%; height:auto; display:block;">
        <p style="text-align: center;">
          <strong>(a) Figure-8:</strong> Distribution of curated demonstrations after filtering 66%. Higher-quality demos are better.
        </p>

        <img src="./static/images/franka_image_dp_distribution_filter_dataset_tuckbox.jpg" alt="Franka Diffusion Policy TuckBox Distribution" style="max-width:100%; height:auto; display:block; margin-top:2rem;">
        <p style="text-align: center;">
          <strong>(b) TuckBox:</strong> Distribution of curated demonstrations after filtering 66%. Pick-and-place demos are better.
        </p>

        <img src="./static/images/franka_image_dp_distribution_filter_dataset_bookshelf.jpg" alt="Franka Diffusion Policy Bookshelf Distribution" style="max-width:100%; height:auto; display:block; margin-top:2rem;">
        <p style="text-align: center;">
          <strong>(c) Bookshelf:</strong> Distribution of curated demonstrations after filtering 50%. Balanced data is better.
        </p>
      </div>
    </div>

    <!-- Q3 -->
    <div class="faq-item">
      <button class="collapsible">Q3: How many policy rollouts does CUPID need for effective curation?</button>
      <div class="faq-content">
        <p style="margin-bottom: 2rem;">
          <strong>CUPID uses a REINFORCE-style estimator to compute the performance influence of each demonstration for curation.</strong>
          Thus, the accuracy of estimated performance influences is dependent on the number of policy rollouts.
          While REINFORCE often yields high-variance gradient estimates under limited rollout budgets, e.g., in RL contexts, we highlight that our curation objective imposes a lower fidelity requirement: since curation with CUPID involves top-k selection, it suffices to rank helpful demonstrations above harmful ones (requiring fewer rollouts) rather than to estimate performance influence precisely (requiring many rollouts). 
          As shown below, the ranking of demonstrations stabilizes with approximately \( m \in [25, 50] \) rollouts on "Lift MH" and "Square MH," and \( m \in [50, 100] \) rollouts on "Transport MH." Similarly, we use only \( m = 25 \) rollouts for our real-world Franka tasks.
        </p>
        <img src="./static/images/robomimic_image_data_quality_rollout_cupid.jpg" alt="RoboMimic Ablation on Number of Rollouts" style="max-width:100%; height:auto; display:block; margin-bottom:8px;">
        <p style="text-align: center;">
          <strong>RoboMimic ablation:</strong> Data quality trends under varying number of rollout trajectories using image-based diffusion policies.
        </p>
      </div>
    </div>

  </div>
</section>



<hr>



<!-- BibTeX. -->
<section class="section" id="BibTeX">
  <div class="container is-max-widescreen content">
    <h2 class="title">BibTeX</h2>
    <pre><code>@unpublished{agia2025cupid,
  author    = {Agia, Christopher and Sinha, Rohan and Yang, Jingyun and Antonova, Rika and Pavone, Marco and Nishimura, Haruki and Itkina, Masha and Bohg, Jeannette},
  title     = {CUPID: Curating Data Your Robot Loves with Influence Functions},
  note      = {Manuscript under review},
  year      = {2025}
}</code></pre>
  </div>
</section>


<!-- References. -->
<section class="section" id="References">
  <div class="container is-max-widescreen content">
    <h2 class="title is-5">References</h2>

    <p>
      [1] Black, K., Brown, N., Driess, D., Esmail, A., Equi, M., Finn, C., ... & Zhilinsky, U. (2024). 
      <em>Ï€<sub>0</sub>: A Vision-Language-Action Flow Model for General Robot Control</em>. 
      arXiv preprint arXiv:2410.24164.
    </p>

    <p>
      [2] Chen, A. S., Lessing, A. M., Liu, Y., & Finn, C. (2025). 
      <em>Curating demonstrations using online experience</em>. 
      arXiv preprint arXiv:2503.03707.
    </p>

    <p>
      [3] Hejna, J., Mirchandani, S., Balakrishna, A., Xie, A., Wahid, A., Tompson, J., ... & Sadigh, D. (2025). 
      <em>Robot Data Curation with Mutual Information Estimators</em>. 
      arXiv preprint arXiv:2502.08623.
    </p>

  </div>
</section>


<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="static/pdfs/CUPID-Curation-2025.pdf">
        <i class="fas fa-file-pdf"></i>
      </a>
      <!-- <a class="icon-link" href="https://github.com/keunhong" class="external-link" disabled>
        <i class="fab fa-github"></i>
      </a> -->
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p></p>
            This website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0 License</a>,
            courtesy of <a href="https://github.com/nerfies/nerfies.github.io">Nerfies</a>, <a href="https://peract.github.io/">PerAct</a>, and <a href="https://emprise.cs.cornell.edu/flair/"> FLAIR.</a>
        </div>
      </div>
    </div>
  </div>
</footer>

  <!-- Toggle buttons. -->
  <script>
    const videoSets = {
      // Diffusion Policy Figure-8.
      dp_figure8: [
        {
          sources: [
            "./static/videos/dp_figure8/base1.mp4",
            "./static/videos/dp_figure8/demoscore1.mp4",
            "./static/videos/dp_figure8/deminf1.mp4",
            "./static/videos/dp_figure8/cupid1.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_figure8/base2.mp4",
            "./static/videos/dp_figure8/demoscore2.mp4",
            "./static/videos/dp_figure8/deminf2.mp4",
            "./static/videos/dp_figure8/cupid2.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_figure8/base3.mp4",
            "./static/videos/dp_figure8/demoscore3.mp4",
            "./static/videos/dp_figure8/deminf3.mp4",
            "./static/videos/dp_figure8/cupid3.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        }
      ],

      // Diffusion Policy TuckBox.
      dp_tuckbox: [
        {
          sources: [
            "./static/videos/dp_tuckbox/base1.mp4",
            null,  // Demo-SCORE [2] not applicable
            "./static/videos/dp_tuckbox/deminf1.mp4",
            "./static/videos/dp_tuckbox/cupid1.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_tuckbox/base2.mp4",
            null,
            "./static/videos/dp_tuckbox/deminf2.mp4",
            "./static/videos/dp_tuckbox/cupid2.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_tuckbox/base3.mp4",
            null,
            "./static/videos/dp_tuckbox/deminf3.mp4",
            "./static/videos/dp_tuckbox/cupid3.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        }
      ],

      // Diffusion Policy Bookshelf.
      dp_bookshelf: [
        {
          sources: [
            "./static/videos/dp_bookshelf/base1.mp4",
            "./static/videos/dp_bookshelf/demoscore1.mp4",
            "./static/videos/dp_bookshelf/deminf1.mp4",
            "./static/videos/dp_bookshelf/cupid1.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_bookshelf/base2.mp4",
            "./static/videos/dp_bookshelf/demoscore2.mp4",
            "./static/videos/dp_bookshelf/deminf2.mp4",
            "./static/videos/dp_bookshelf/cupid2.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        },
        {
          sources: [
            "./static/videos/dp_bookshelf/base3.mp4",
            "./static/videos/dp_bookshelf/demoscore3.mp4",
            "./static/videos/dp_bookshelf/deminf3.mp4",
            "./static/videos/dp_bookshelf/cupid3.mp4"
          ],
          captions: ["Base Policy - All Demos", "Demo-SCORE [2]", "DemInf [3]", "CUPID (Ours)"]
        }
      ]
    };

    function switchSet(taskId, setIndex) {
      const set = videoSets[taskId][setIndex];
      for (let i = 0; i < 4; i++) {
        const video = document.getElementById(`${taskId}-video${i + 1}`);
        const caption = document.getElementById(`${taskId}-caption${i + 1}`);
        const source = video?.querySelector("source");

        const src = set.sources[i];
        caption.innerText = set.captions[i];

        if (src === null) {
          // Handle placeholder case
          video.style.display = "none";
          const placeholder = document.createElement("div");
          placeholder.className = "video-crop-container placeholder-gray";
          placeholder.id = `${taskId}-placeholder${i + 1}`;
          video.parentElement.insertBefore(placeholder, video);
        } else {
          // Remove existing placeholder if present
          const existing = document.getElementById(`${taskId}-placeholder${i + 1}`);
          if (existing) existing.remove();

          video.style.display = "block";
          source.src = src;
          video.load();
        }
      }

      // Update button styling
      const buttonGroup = document.querySelectorAll(`[onclick^="switchSet('${taskId}'"]`);
      buttonGroup.forEach((btn, idx) => {
        btn.classList.toggle('is-selected', idx === setIndex);
      });
    }
  </script>

  <script>
    const pi0VideoSets = {
      pi0_figure8: [
        ["./static/videos/pi0_figure8/base1.mp4", "./static/videos/pi0_figure8/cupid1.mp4"],
        ["./static/videos/pi0_figure8/base2.mp4", "./static/videos/pi0_figure8/cupid2.mp4"]
      ],
      pi0_tuckbox: [
        ["./static/videos/pi0_tuckbox/base1.mp4", "./static/videos/pi0_tuckbox/cupid1.mp4"],
        ["./static/videos/pi0_tuckbox/base2.mp4", "./static/videos/pi0_tuckbox/cupid2.mp4"]
      ]
    };

    function switchPi0Set(taskId, setIndex) {
      const sources = pi0VideoSets[taskId][setIndex];
      for (let i = 0; i < sources.length; i++) {
        const video = document.getElementById(`${taskId}-video${i + 1}`);
        const source = video.querySelector("source");
        source.src = sources[i];
        video.load();
      }

      // Update selected button styling per task
      const buttonGroup = document.querySelectorAll(`[onclick^="switchPi0Set('${taskId}'"]`);
      buttonGroup.forEach((btn, idx) => {
        btn.classList.toggle("is-selected", idx === setIndex);
      });
    }
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const collapsibles = document.querySelectorAll(".collapsible");
      collapsibles.forEach(btn => {
        btn.addEventListener("click", function() {
          this.classList.toggle("active");
          const content = this.nextElementSibling;
          if (content.style.display === "block") {
            content.style.display = "none";
          } else {
            content.style.display = "block";
          }
        });
      });
    });
  </script>

</body>
</html>
